<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excelsior Deckbuilder - Characters Database</title>
    <!-- Database View CSS - Step 2 Refactoring -->
    <link rel="stylesheet" href="/css/database-view.css">
    <!-- Base styles still needed from main CSS -->
    <link rel="stylesheet" href="/css/index.css">
</head>
<body>
    <!-- Login Form -->
    <div id="loginContainer" class="login-container">
        <form id="loginForm" class="login-form">
            <h2>üîê Login to Database</h2>
            <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" required placeholder="Enter your username">
            </div>
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required placeholder="Enter your password">
            </div>
            <button type="submit" class="login-btn">Log In</button>
            <div id="loginError" class="login-error">Invalid username or password</div>
        </form>
    </div>

    <div class="container" id="mainContainer" style="display: none;">
        <!-- Global Navigation Component -->
        <div id="globalNav"></div>

        <!-- Database View Section - Loaded from template -->
        <div id="database-view-container">
            <!-- Database view content will be loaded here -->
        </div>

        <!-- Deck Builder Section -->
        <div id="deck-builder" class="deck-builder-section" style="display: none;">
            <!-- Deck List -->
            <div class="deck-list-container">
                <div class="deck-stats">
                    <div class="stat-card">
                        <div class="stat-info">
                            <div class="stat-number" id="total-decks">-</div>
                            <div class="stat-label">Total Decks</div>
                        </div>
                        <button class="create-deck-btn" onclick="showCreateDeckModal()">Create New Deck</button>
                    </div>
                </div>
                
                <div class="deck-list" id="deck-list">
                    <!-- Decks will be loaded here -->
                </div>
            </div>
        </div>

    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <img id="modalImage" src="" alt="Card Image">
        </div>
    </div>

    <!-- Create Deck Modal -->
    <div id="createDeckModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Create New Deck</h2>
            <form id="createDeckForm">
                <div class="form-group">
                    <label for="deckName">Deck Name:</label>
                    <input type="text" id="deckName" name="deckName" required>
                </div>
                <div class="form-group">
                    <label for="deckDescription">Description:</label>
                    <textarea id="deckDescription" name="deckDescription" rows="3"></textarea>
                </div>
                <button type="submit" class="create-deck-btn">Create Deck</button>
            </form>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="/js/globalNav.js"></script>
    <script src="/js/data-loading.js"></script>
    <script src="/js/search-filter.js"></script>
    <script src="/js/search-filter-functions.js"></script>
    <script src="/js/filter-functions.js"></script>
    <!-- Step 4: New Filter System -->
    <script src="/js/filter-utilities.js"></script>
    <script src="/js/filter-manager.js"></script>
    <!-- Step 5: New Component Structure -->
    <script src="/js/database-view-core.js"></script>
    <script src="/js/database-view-tabs.js"></script>
    <script src="/js/database-view-search.js"></script>
    <script src="/js/database-view-display.js"></script>
    <script src="/js/data-loading-core.js"></script>
    <script src="/js/deck-editor-simple.js"></script>
    <script src="/js/database-view.js"></script>
    <script src="/js/ui-utility-functions.js"></script>
    <script src="/js/deck-management.js"></script>
    <script src="/js/auth-service.js"></script>
    <script src="/js/utilities.js"></script>

    <script>
        // Database View Template Loader - Step 1 Refactoring
        async function loadDatabaseViewTemplate() {
            try {
                console.log('Loading database view template...');
                const response = await fetch('/templates/database-view-complete.html');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const templateContent = await response.text();
                console.log('Template loaded successfully, length:', templateContent.length);
                
                const container = document.getElementById('database-view-container');
                if (container) {
                    container.innerHTML = templateContent;
                    console.log('Template content inserted into container');
                } else {
                    console.error('Database view container not found');
                }
            } catch (error) {
                console.error('Error loading database view template:', error);
                const container = document.getElementById('database-view-container');
                if (container) {
                    container.innerHTML = '<div class="error">Failed to load database view template</div>';
                }
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Database page DOM loaded');
            loadDatabaseViewTemplate().then(() => {
                // Initialize the new component structure after template is loaded
                if (window.databaseViewCore) {
                    console.log('Initializing new component structure...');
                    window.databaseViewCore.initialize();
                } else {
                    console.warn('Database view core not available');
                }
            });
        });
    </script>
</body>
</html>